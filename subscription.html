<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Subscription · AI Photo Studio</title>

<style>
    body {
        margin:0;
        background:#0b0f19;
        color:white;
        font-family:Inter,system-ui,sans-serif;
    }

    .topbar {
        height:60px;
        background:#111827;
        border-bottom:1px solid #1f2937;
        display:flex;
        align-items:center;
        justify-content:space-between;
        padding:0 20px;
    }

    .logo {
        font-size:20px;
        color:#3fb7ff;
        font-weight:700;
        text-shadow:0 0 10px #3fb7ff;
    }

    .content {
        max-width:430px;
        margin:30px auto;
        padding:20px;
    }

    h1 {
        font-size:26px;
        margin-bottom:10px;
        text-align:center;
    }

    p {
        opacity:0.8;
        text-align:center;
        margin-bottom:20px;
    }

    .card {
        background:#111827;
        border:1px solid #1f2937;
        padding:20px;
        border-radius:14px;
        margin-bottom:25px;
    }

    .price {
        font-size:34px;
        font-weight:900;
        text-align:center;
        margin-bottom:6px;
        color:#3fb7ff;
        text-shadow:0 0 12px #3fb7ff;
    }

    .btn {
        width:100%;
        padding:16px;
        border:none;
        border-radius:12px;
        cursor:pointer;
        font-weight:700;
        font-size:16px;
        margin-top:10px;
        color:white;
        background:#2563eb;
    }

    .btn:hover {
        opacity:.9;
    }

    .link {
        margin-top:12px;
        display:block;
        text-align:center;
        color:#60a5fa;
        font-size:14px;
    }

    .feature {
        padding:8px 0;
        border-bottom:1px solid #1f2937;
        opacity:0.85;
        font-size:15px;
    }

</style>
</head>
<body>

<div class="topbar">
    <div class="logo">AI Photo Studio</div>
    <div onclick="history.back()" style="color:#60a5fa;cursor:pointer;">← Back</div>
</div>

<div class="content">

    <h1>Unlock AI Photo Studio Pro</h1>
    <p>Start your free 7-day trial, cancel anytime. No charge until the trial ends.</p>

    <div class="card">

        <div class="price">£24.99 / year</div>

        <div class="feature">✔ Unlimited Remove Background</div>
        <div class="feature">✔ Unlimited Change Background</div>
        <div class="feature">✔ Unlimited Remove Person</div>
        <div class="feature">✔ Unlimited Magic Eraser / Object Removal</div>
        <div class="feature">✔ No Ads</div>
        <div class="feature">✔ No Watermarks</div>
        <div class="feature">✔ High-Resolution Exports</div>
        <div class="feature">✔ Priority Processing Speed</div>

        <button class="btn" id="startTrialBtn">Start Free 7-Day Trial</button>

        <a class="link" id="manageSubLink" style="display:none;">Manage Subscription</a>
    </div>

</div>

<script type="module">
    import { auth, onAuthStateChanged } from "./firebase-app.js";
    import { db } from "./db.js";
    import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    let customerPortalURL = ""; // You will paste your Stripe customer portal link here later

    onAuthStateChanged(auth, async (user) => {
        if (!user) return location.href = "signin.html";

        const ref = doc(db, "users", user.uid);
        const snap = await getDoc(ref);

        if (!snap.exists()) return;

        const data = snap.data();

        // Show manage subscription button for paying users
        if (data.plan === "pro") {
            document.getElementById("manageSubLink").style.display = "block";
            document.getElementById("manageSubLink").onclick = () => {
                if (!customerPortalURL) return alert("Subscription portal not connected yet.");
                location.href = customerPortalURL;
            };
        }
    });

    document.getElementById("startTrialBtn").onclick = async () => {
        const user = auth.currentUser;
        if (!user) return location.href = "signin.html";

        const ref = doc(db, "users", user.uid);

        await updateDoc(ref, {
            plan: "trial",
            trialStarted: Date.now()
        });

        location.href = "subscription-success.html";
    };
</script>

</body>
</html>
