<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>My Gallery Â· AI Photo Studio</title>

<style>
    body {
        margin: 0;
        background: #0b0f19;
        color: white;
        font-family: Inter, system-ui, sans-serif;
    }

    /* TOP BAR */
    .topbar {
        height: 60px;
        background: #111827;
        border-bottom: 1px solid #1f2937;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
    }
    .logo {
        font-size: 20px;
        font-weight: 700;
        color: #3fb7ff;
        cursor: pointer;
        text-shadow: 0 0 10px #3fb7ff;
    }

    /* CONTAINER */
    .container {
        max-width: 430px;
        margin: auto;
        padding: 18px;
    }

    h1 {
        text-align: center;
        font-size: 26px;
        margin-bottom: 15px;
    }

    /* TAB BUTTONS */
    .tabs {
        display: flex;
        justify-content: space-between;
        margin-bottom: 18px;
    }
    .tab {
        flex: 1;
        padding: 10px 0;
        text-align: center;
        background: #111827;
        border: 1px solid #1f2937;
        border-radius: 10px;
        margin: 0 5px;
        cursor: pointer;
        font-size: 13px;
    }
    .tab.active {
        background: #2563eb;
        border-color: #3fb7ff;
        font-weight: 700;
    }

    /* IMAGE GRID */
    .grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    .grid img {
        width: 100%;
        height: 120px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        border: 1px solid #1f2937;
    }

    /* EMPTY MESSAGE */
    .empty {
        text-align: center;
        opacity: 0.6;
        margin-top: 40px;
        font-size: 15px;
    }
</style>
</head>

<body>

<div class="topbar">
    <div class="logo" onclick="location.href='index.html'">AI Photo Studio</div>
    <div onclick="location.href='settings.html'" style="cursor:pointer;color:#60a5fa;">Settings</div>
</div>

<div class="container">

    <h1>My Gallery</h1>

    <!-- TABS -->
    <div class="tabs">
        <div class="tab active" onclick="switchFolder('all')">All</div>
        <div class="tab" onclick="switchFolder('remove-bg')">BG Removed</div>
        <div class="tab" onclick="switchFolder('change-bg')">Changed BG</div>
        <div class="tab" onclick="switchFolder('person')">Remove Person</div>
        <div class="tab" onclick="switchFolder('object')">Objects</div>
    </div>

    <!-- IMAGE GRID -->
    <div id="galleryGrid" class="grid"></div>

    <p id="emptyMessage" class="empty" style="display:none;">No images found in this folder.</p>

</div>

<script type="module">
import { auth, onAuthStateChanged } from "./firebase-app.js";
import { storage, ref, listAll, getDownloadURL } from "./firebase-app.js";

let currentFolder = "all";

onAuthStateChanged(auth, user => {
    if (!user) return location.href = "signin.html";
    loadFolder("all");
});

/* SWITCH TABS */
function switchFolder(folder) {
    currentFolder = folder;

    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    event.target.classList.add("active");

    loadFolder(folder);
}

/* LOAD IMAGES */
async function loadFolder(folder) {
    const user = auth.currentUser;
    const grid = document.getElementById("galleryGrid");
    const emptyMessage = document.getElementById("emptyMessage");

    grid.innerHTML = "";
    emptyMessage.style.display = "none";

    let path = "";

    if (folder === "all") path = `users/${user.uid}/gallery/`;
    else path = `users/${user.uid}/gallery/${folder}/`;

    try {
        const folderRef = ref(storage, path);
        const result = await listAll(folderRef);

        if (result.items.length === 0) {
            emptyMessage.style.display = "block";
            return;
        }

        result.items.forEach(async (itemRef) => {
            const url = await getDownloadURL(itemRef);

            const img = document.createElement("img");
            img.src = url;
            img.onclick = () => {
                localStorage.setItem("viewImage", url);
                location.href = "gallery-view.html";
            };

            grid.appendChild(img);
        });

    } catch (e) {
        console.error(e);
        emptyMessage.style.display = "block";
    }
}
</script>

</body>
</html>
