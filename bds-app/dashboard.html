<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Photo Studio — Dashboard</title>
    <link rel="stylesheet" href="dashboard.css" />

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCM6r66kW9xkBA5rgVcz4sP57N2v2BMbkg",
            authDomain: "ai-photo-studio-24354.firebaseapp.com",
            projectId: "ai-photo-studio-24354",
            storageBucket: "ai-photo-studio-24354.firebasestorage.app",
            messagingSenderId: "411346648650",
            appId: "1:411346648650:web:aefd1b26027ed5e8fab0b3",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "/signin.html";
                return;
            }

            document.getElementById("userEmail").innerText = user.email;

            const ref = doc(db, "users", user.uid);
            const snap = await getDoc(ref);

            if (snap.exists() && snap.data().isPro === true) {
                document.body.classList.add("pro-user");
                document.getElementById("upgradeBanner").style.display = "none";
            }
        });

        window.logout = () => signOut(auth).then(() => {
            window.location.href = "/signin.html";
        });
    </script>
</head>

<body>

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2 class="logo">AI Photo<br>Studio</h2>

        <nav>
            <a class="nav-item active">Editor</a>
            <a class="nav-item" href="gallery.html">My Gallery</a>
            <a class="nav-item" href="account.html">Account</a>
        </nav>

        <div class="sidebar-bottom">
            <p id="userEmail" class="user-email">Loading...</p>
            <button class="logout-btn" onclick="logout()">Sign Out</button>
        </div>
    </aside>

    <!-- MAIN AREA -->
    <main class="main-content">

        <!-- UPGRADE BANNER (hidden for PRO users) -->
        <div id="upgradeBanner" class="upgrade-banner">
            <span>✨ Unlock Remove BG, Change BG, Blur Tool + No Watermarks</span>
            <button onclick="openPaywall()" class="upgrade-btn">Start 7-Day Free Trial</button>
        </div>

        <!-- EDITOR WRAPPER -->
        <div class="editor-wrapper">

            <!-- IMAGE PREVIEW -->
            <div class="preview-box">
                <img id="previewImage" class="preview-img" src="placeholder.jpg" alt="" />
                <div id="beforeAfter" class="before-after hidden"></div>
                <canvas id="workCanvas"></canvas>
                <div id="watermark" class="wm hidden">AI Photo Studio</div>
            </div>

            <!-- TOOL DOCK -->
            <div class="tool-dock">
                <button onclick="triggerUpload()">Upload</button>
                <button onclick="enhancePhoto()">Enhance</button>
                <button onclick="removeBG()">Remove BG</button>
                <button onclick="openBgPanel()">Change BG</button>
                <button onclick="blurBG()">Blur BG</button>
                <button onclick="savePhoto()">Save</button>
            </div>

        </div>
    </main>

    <!-- BACKGROUND PANEL -->
    <div id="bgPanel" class="bg-panel hidden">
        <h3>Choose Background</h3>

        <div class="bg-grid">
            <div class="bg-option solid dark"></div>
            <div class="bg-option solid light"></div>
            <div class="bg-option img" style="background-image:url('/bg-presets/bg1.jpg')"></div>
            <div class="bg-option img" style="background-image:url('/bg-presets/bg2.jpg')"></div>
            <div class="bg-option img" style="background-image:url('/bg-presets/bg3.jpg')"></div>
        </div>

        <button onclick="closeBgPanel()" class="close-bg-panel">Close</button>
    </div>

    <!-- FILE UPLOADER -->
    <input type="file" id="uploadInput" accept="image/*" hidden />

    <script src="dashboard.js"></script>
</body>
</html>
