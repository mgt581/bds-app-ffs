<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>View Photo Â· AI Photo Studio</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

<style>
body {
    margin: 0;
    background: #0b0f1c;
    color: white;
    font-family: Inter, sans-serif;
}

.topbar {
    height: 70px;
    background: #111827;
    border-bottom: 1px solid #1f2937;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 24px;
}

.logo {
    font-size: 22px;
    font-weight: 700;
    color: #3fb7ff;
    text-shadow: 0 0 10px #3fb7ff;
}

.nav-btn {
    padding: 10px 18px;
    border-radius: 10px;
    background: #1f2937;
    border: 1px solid #334155;
    color: white;
    cursor: pointer;
    margin-left: 10px;
}

.page {
    padding: 20px;
    max-width: 900px;
    margin: auto;
    text-align: center;
}

#viewImg {
    width: 100%;
    max-width: 900px;
    border-radius: 12px;
    margin-top: 20px;
    border: 1px solid #1f2937;
    box-shadow: 0 0 20px rgba(63, 183, 255, 0.2);
}

.btn-row {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 14px;
}

.action-btn {
    padding: 12px 22px;
    background: #1f2937;
    border: 1px solid #334155;
    border-radius: 12px;
    cursor: pointer;
    color: white;
    font-weight: 600;
}

.action-btn:hover {
    border-color: #3fb7ff;
    box-shadow: 0 0 10px #3fb7ff70;
}

.watermark {
    position: absolute;
    bottom: 20px;
    right: 20px;
    opacity: 0.75;
    font-size: 18px;
    background: rgba(0,0,0,0.45);
    padding: 6px 12px;
    border-radius: 8px;
}
</style>
</head>

<body>

<div class="topbar">
    <div class="logo">Photo Viewer</div>

    <div>
        <button class="nav-btn" onclick="location.href='gallery.html'">Back to Gallery</button>
        <button class="nav-btn" onclick="location.href='profile.html'">My Account</button>
        <button class="nav-btn" onclick="signOutUser()">Sign Out</button>
    </div>
</div>

<div class="page">
    <h1>Preview</h1>
    <div style="position: relative; display: inline-block;">
        <img id="viewImg" src="" alt="Photo" />
        <div id="wm" class="watermark" style="display:none;">AI Photo Studio</div>
    </div>

    <div class="btn-row">
        <button class="action-btn" onclick="downloadImage()">Download</button>
        <button class="action-btn" onclick="shareImage()">Share</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCM6r66kW9xkBA5rgVcz4sP57N2v2BMbkg",
    authDomain: "ai-photo-studio-24354.firebaseapp.com",
    projectId: "ai-photo-studio-24354",
    storageBucket: "ai-photo-studio-24354.appspot.com",
    messagingSenderId: "411346648650",
    appId: "1:411346648650:web:aefd1b26027ed5e8fab0b3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let imgURL = localStorage.getItem("selectedImage");

document.getElementById("viewImg").src = imgURL;

// ðŸ”µ Apply watermark for FREE USERS
onAuthStateChanged(auth, async (user) => {
    if (!user) return location.href = "signin.html";

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    let plan = snap.exists() ? snap.data().plan : "free";

    if (plan !== "pro") {
        document.getElementById("wm").style.display = "block";
    }
});

// ðŸ”µ DOWNLOAD IMAGE
function downloadImage() {
    const link = document.createElement("a");
    link.href = imgURL;
    link.download = "photo.png";
    link.click();
}

// ðŸ”µ SHARE IMAGE
function shareImage() {
    if (navigator.share) {
        navigator.share({
            title: "My Edited Photo",
            url: imgURL
        });
    } else {
        alert("Sharing not supported on this device.");
    }
}

// ðŸ”µ SIGN OUT
function signOutUser() {
    signOut(auth).then(() => location.href = "signin.html");
}
</script>

</body>
</html>
