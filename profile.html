<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>My Account — AI Photo Studio</title>

<style>
    body {
        margin: 0;
        background: #0b0f19;
        color: white;
        font-family: Inter, system-ui, sans-serif;
    }

    .topbar {
        height: 60px;
        background: #111827;
        border-bottom: 1px solid #1f2937;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
    }

    .logo {
        color: #3fb7ff;
        font-size: 20px;
        font-weight: 700;
        text-shadow: 0 0 10px #3fb7ff;
    }

    .content {
        max-width: 450px;
        margin: 40px auto;
        padding: 20px;
    }

    h2 {
        font-size: 22px;
        margin-bottom: 10px;
    }

    .card {
        background: #111827;
        border: 1px solid #1f2937;
        border-radius: 14px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .label {
        opacity: 0.7;
        font-size: 14px;
        margin-bottom: 6px;
    }

    .value {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
    }

    .btn {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: none;
        font-weight: 700;
        cursor: pointer;
        font-size: 15px;
    }

    .btn-blue {
        background: #2563eb;
        color: white;
    }

    .btn-dark {
        background: #1f2937;
        color: white;
    }

    .btn-red {
        background: #b91c1c;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }

    .link {
        color: #60a5fa;
        text-align: center;
        display: block;
        margin-top: 12px;
    }
</style>
</head>

<body>

<div class="topbar">
    <div class="logo">AI Photo Studio</div>
    <div class="btn-back" onclick="location.href='dashboard.html'" style="cursor:pointer;color:#60a5fa;">← Dashboard</div>
</div>

<div class="content">

    <div class="card">
        <h2>Your Account</h2>

        <div class="label">Email</div>
        <div class="value" id="userEmail">Loading...</div>

        <div class="label">Subscription</div>
        <div class="value" id="userPlan">Checking...</div>

        <button class="btn btn-blue" id="upgradeBtn">Upgrade / Manage Subscription</button>
    </div>

    <div class="card">
        <h2>Security</h2>

        <button class="btn btn-dark" id="changeEmailBtn">Change Email</button>
        <button class="btn btn-dark" id="changePassBtn">Change Password</button>
    </div>

    <div class="card">
        <h2>Danger Zone</h2>

        <button class="btn btn-red" id="deleteBtn">Delete Account</button>
    </div>

    <button class="btn btn-dark" id="logoutBtn">Sign Out</button>
</div>


<!-- FIREBASE LOGIC -->
<script type="module">
    import { 
        auth, 
        onAuthStateChanged, 
        signOut, 
        updateEmail,
        updatePassword,
        deleteUser 
    } from "./firebase-app.js";

    import { db } from "./db.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    let currentUser;

    onAuthStateChanged(auth, async (user) => {
        if (!user) return location.href = "signin.html";

        currentUser = user;

        document.getElementById("userEmail").innerText = user.email || "Anonymous Account";

        const ref = doc(db, "users", user.uid);
        const snap = await getDoc(ref);

        let plan = "Free User";

        if (snap.exists()) {
            const data = snap.data();
            if (data.plan === "pro") plan = "Pro Member";
            if (data.plan === "trial") plan = "Free Trial (7 Days)";
            if (data.plan === "daypass") plan = "Day Pass Active";
        }

        document.getElementById("userPlan").innerText = plan;
    });

    // Upgrade button
    document.getElementById("upgradeBtn").onclick = () => {
        location.href = "subscription.html";
    };

    // Change email
    document.getElementById("changeEmailBtn").onclick = async () => {
        const newEmail = prompt("Enter new email:");
        if (!newEmail) return;
        try {
            await updateEmail(currentUser, newEmail);
            alert("Email updated!");
            location.reload();
        } catch (err) {
            alert("Error: " + err.message);
        }
    };

    // Change password
    document.getElementById("changePassBtn").onclick = async () => {
        const newPass = prompt("Enter new password:");
        if (!newPass) return;
        try {
            await updatePassword(currentUser, newPass);
            alert("Password updated!");
        } catch (err) {
            alert("Error: " + err.message);
        }
    };

    // Delete account
    document.getElementById("deleteBtn").onclick = async () => {
        if (!confirm("This will permanently delete your account. Continue?")) return;
        try {
            await deleteUser(currentUser);
            alert("Account deleted.");
            location.href = "signin.html";
        } catch (err) {
            alert("Error: " + err.message);
        }
    };

    // Sign out
    document.getElementById("logoutBtn").onclick = async () => {
        await signOut(auth);
        location.href = "signin.html";
    };
</script>

</body>
</html>
